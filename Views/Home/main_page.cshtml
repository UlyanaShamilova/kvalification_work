@model project.Models.MainPageViewModel
@{
    ViewData["Title"] = "Головна сторінка";
}

@section Styles {
    <link rel="stylesheet" href="~/css/main.css"/>
}

@section Scripts {
    <script src="~/js/main.js"></script>
    <script src="~/js/saved.js"></script>
}

<h2>Що бажаєте приготувати?</h2>

<form id="searchForm" method="get" class="search-bar">
    <input type="text" id="searchInput" placeholder="Пошук за назвою чи інгредієнтом" />
    <button type="button" id="searchBtn"><img id = "searchImg" src="/images/search_img.png" alt=""></button>
</form>

<div class="category-bar">
    @foreach (var card in Model.CategoryCards)
    {
        <div class="category-link" data-category="@card.Category.category_name">
            @if (card.Category.Photo != null)
            {
                <img src="data:image/jpeg;base64,@Convert.ToBase64String(card.Category.Photo)" alt="@card.Category.category_name" />
            }
            
            <div class="category-title">@card.Category.category_name</div>
        </div>
    }
</div>

<div class="recipe-container">
@foreach (var recipe in Model.Recipes)
{
    <div class="recipe-card" data-category="@((recipe.Category?.category_name ?? "").ToLower())">
        <a href="@Url.Action("Details", "Home", new { id = recipe.recipeID })" class="recipe-link" style="text-decoration:none; color:inherit; display:block;">
            <div class="photo-class">
                @if (!string.IsNullOrEmpty(recipe.Photo))
                {
                    <img src="@recipe.Photo" alt="Фото рецепта" />
                }
                else
                {
                    <img src="/images/default.jpg" alt="Без зображення" />
                }
            </div>

            
            @{
            var time = recipe.time_cooking;
            string formattedTime = "Не вказано";

            if (time.HasValue)
            {
                int hours = time.Value.Hours;
                int minutes = time.Value.Minutes;

                if (hours > 0 && minutes > 0)
                {
                    // Якщо є обидва - години:хвилини
                    formattedTime = $"{hours}:{minutes:D2} год";
                }
                else if (hours > 0)
                {
                    // Якщо тільки години (хвилини = 0)
                    formattedTime = $"{hours} год";
                }
                else if (minutes > 0)
                {
                    // Якщо тільки хвилини
                    formattedTime = $"{minutes} хв";
                }
            }
        }
        <span><img id="time-img" src="~/images/watch.png"> @formattedTime</span>

            <div class="recipe-category">@recipe.Category?.category_name</div>
            <span class="recipe-name">@recipe.recipe_name</span>
        </a>

        <div class="recipe-ingredients" style="display:none;">@recipe.ingredients</div>

        <div class="card-footer">
            <button class="save-btn" data-id="@recipe.recipeID" aria-label="Зберегти рецепт" style="background:none; border:none;">
                <img src="@(recipe.IsSaved ? "/images/filled_star.jpg" : "/images/empty_star.jpg")" 
                     alt="Зберегти рецепт" style="width:24px; height:24px;" />
            </button>
        </div>
    </div>
}
</div>

<div id="chatbot" onclick="toggleChat()">
    <img src="~/images/ai_main.png" alt="">
</div>

<div id="chat-window">
    <div class="chat-header">
        <span>Кулінарний помічник</span>
        <button id="chat-close" onclick="toggleChat()">×</button>
    </div>
    <div id="chat-messages"></div>
    <div class="chat-input">
        <input type="text" id="chat-text" placeholder="Яке в тебе питання?" />
        <button onclick="sendMessage()">→</button>
    </div>
</div>