@model project.Models.Recipe


@{
    var commentsArr = ViewBag.Comments as Comments[];
}


@section Scripts {
    <script src="~/js/comments.js"></script>
}

@section Styles {
    <link rel="stylesheet" href="~/css/details.css"/>
}

<div class="back-button">
    <a href="/Home/main_page" class="back-arrow-icon">
        <img src="~/images/back_arrow.png" alt="Назад" />
    </a>
</div>


<div class="container">
    <div class="left">
        <h2>@Model.recipe_name</h2>

        @if (!string.IsNullOrEmpty(Model.Photo))
        {
            <img id="recipePhoto" src="@Model.Photo" alt="Фото рецепта" class="img-fluid mt-3" />
        }

        <p>Категорія:@Model.Category?.category_name</p>

        @{
            var time = Model.time_cooking;
            string formattedTime = "Не вказано";

            if (time.HasValue)
            {
                int hours = time.Value.Hours;
                int minutes = time.Value.Minutes;

                if (hours > 0 && minutes > 0)
                {
                    // Якщо є обидва - години:хвилини
                    formattedTime = $"{hours}:{minutes:D2} год";
                }
                else if (hours > 0)
                {
                    // Якщо тільки години (хвилини = 0)
                    formattedTime = $"{hours} год";
                }
                else if (minutes > 0)
                {
                    // Якщо тільки хвилини
                    formattedTime = $"{minutes} хв";
                }
            }
        }
        <p><img id="time-img" src="~/images/watch.png"> @formattedTime</p>

        @if (User?.Identity?.IsAuthenticated == true)
        {
            <form asp-controller="Saved" asp-action="Save" method="post">
                <input type="hidden" name="recipeId" value="@Model.recipeID" />
                <button type="submit" id="save-btn">Зберегти рецепт</button>
            </form>
        }
    </div>

    <div class="center">
        <div id="ingredients">
            <h4>Інгредієнти</h4>
            <ul>
                @foreach (var ing in Model.IngredientsArr)
                {
                    @ing
                    <hr />
                }
            </ul>
        </div>
    </div>

    <div class="right">
        <div class="similar-recipes">
        <h3>Схожі рецепти</h3>
        @if (ViewBag.SimilarRecipes != null && ((List<project.Models.Recipe>)ViewBag.SimilarRecipes).Count > 0)
        {
            <ul>
                @foreach (var rec in (List<project.Models.Recipe>)ViewBag.SimilarRecipes)
                {
                    <div id="recipe-card" style="margin-bottom: 15px;">
                        <a href="@Url.Action("details", "Home", new { id = rec.recipeID })" style="display: flex; align-items: center; text-decoration: none; color: inherit;">
                            <div class="photo-class" style="flex-shrink: 0;">
                                @if (!string.IsNullOrEmpty(rec.Photo))
                                {
                                    <img src="@rec.Photo" alt="@rec.recipe_name" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 10px;" />
                                }
                                else
                                {
                                    <img src="/images/default.jpg" alt="Без зображення" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 10px;" />
                                }
                            </div>
                            <span>@rec.recipe_name</span>
                        </a>
                    </div>
                }
            </ul>
        } else
        {
            <p>Схожих рецептів не знайдено.</p>
        }
        </div>
    </div>
</div>

<div id="instructions">
    <h4>Інструкції приготування</h4>
    <ol>
        @foreach (var ing in Model.InstructionsArr)
        {
            <li>@ing</li>
            <hr />
        }
    </ol>
</div>

<div id="comments">
<h3>Коментарі</h3>
    @if (ViewBag.Comments != null)
    {
        foreach (var comment in (List<project.Models.Comments>)ViewBag.Comments)
        {
            @await Html.PartialAsync("~/Views/Comments/Comments.cshtml", comment)
        }
    }
</div>

@if (User?.Identity?.IsAuthenticated == true)
{
    <form id="commentForm">
    <input type="hidden" id="recipeId" name="recipeID" value="@Model.recipeID" />
    <textarea id="comment_text" name="text" placeholder="Напишіть ваш коментар" required></textarea>
    <button type="submit" class="btn-comment">Додати</button>
</form>
}
else
{
    <div class="login-reminder">
    <p><a href="/Acc/Login">Увійдіть</a> щоб залишити коментар</p>
    </div>
}